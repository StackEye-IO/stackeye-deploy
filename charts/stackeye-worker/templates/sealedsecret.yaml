{{- if .Values.sealedSecrets.enabled }}
# SealedSecret for stackeye-worker
# To create: kubectl create secret generic {{ include "stackeye-worker.fullname" . }}-secrets \
#   --from-literal=DATABASE_URL='postgres://...' \
#   --dry-run=client -o yaml | kubeseal --format yaml > sealedsecret.yaml
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: {{ include "stackeye-worker.fullname" . }}-secrets
  labels:
    {{- include "stackeye-worker.labels" . | nindent 4 }}
spec:
  encryptedData:
    {{- range $key, $value := .Values.sealedSecrets.encryptedData }}
    {{ $key }}: {{ $value | quote }}
    {{- end }}
  template:
    metadata:
      name: {{ include "stackeye-worker.fullname" . }}-secrets
      labels:
        {{- include "stackeye-worker.labels" $ | nindent 8 }}
    type: Opaque
{{- else }}
# Plain Kubernetes Secret (for development only)
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "stackeye-worker.fullname" . }}-secrets
  labels:
    {{- include "stackeye-worker.labels" . | nindent 4 }}
type: Opaque
stringData:
  DATABASE_URL: "postgres://stackeye:changeme@localhost:5432/stackeye?sslmode=disable"
{{- end }}
