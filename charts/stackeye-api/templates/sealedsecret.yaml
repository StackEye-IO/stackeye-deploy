{{- if not .Values.secrets.existingSecretName }}
{{- if .Values.sealedSecrets.enabled }}
# SealedSecret for stackeye-api
# To create: kubectl create secret generic {{ include "stackeye-api.fullname" . }}-secrets \
#   --from-literal=DATABASE_URL='postgres://...' \
#   --from-literal=JWT_SECRET='...' \
#   --from-literal=STRIPE_SECRET_KEY='...' \
#   --from-literal=STRIPE_WEBHOOK_SECRET='...' \
#   --from-literal=STRIPE_PUBLISHABLE_KEY='...' \
#   --from-literal=EMAIL_API_KEY='...' \
#   --dry-run=client -o yaml | kubeseal --format yaml > sealedsecret.yaml
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: {{ include "stackeye-api.fullname" . }}-secrets
  labels:
    {{- include "stackeye-api.labels" . | nindent 4 }}
spec:
  encryptedData:
    {{- range $key, $value := .Values.sealedSecrets.encryptedData }}
    {{ $key }}: {{ $value | quote }}
    {{- end }}
  template:
    metadata:
      name: {{ include "stackeye-api.fullname" . }}-secrets
      labels:
        {{- include "stackeye-api.labels" $ | nindent 8 }}
    type: Opaque
{{- else }}
# Plain Kubernetes Secret (for development only - not recommended for production)
# In production, use SealedSecrets by setting sealedSecrets.enabled=true
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "stackeye-api.fullname" . }}-secrets
  labels:
    {{- include "stackeye-api.labels" . | nindent 4 }}
type: Opaque
stringData:
  DATABASE_URL: {{ .Values.secrets.databaseUrl | default "postgres://stackeye:changeme@localhost:5432/stackeye?sslmode=disable" | quote }}
  JWT_SECRET: {{ .Values.secrets.jwtSecret | default "replace-with-32-character-minimum-secret-key" | quote }}
  REDIS_URL: {{ .Values.secrets.redisUrl | default "" | quote }}
  STRIPE_SECRET_KEY: {{ .Values.secrets.stripeSecretKey | default "" | quote }}
  STRIPE_WEBHOOK_SECRET: {{ .Values.secrets.stripeWebhookSecret | default "" | quote }}
  STRIPE_PUBLISHABLE_KEY: {{ .Values.secrets.stripePublishableKey | default "" | quote }}
  EMAIL_API_KEY: {{ .Values.secrets.emailApiKey | default "" | quote }}
  {{- if .Values.auth0.enabled }}
  AUTH0_CLIENT_SECRET: {{ .Values.secrets.auth0ClientSecret | default "" | quote }}
  {{- end }}
{{- end }}
{{- end }}
{{- /* When existingSecretName is set, no secret is created - use existing secret */}}
